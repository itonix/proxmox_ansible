plugin: community.proxmox.proxmox
url: https://192.168.88.133:8006
user: root@pam
password: "@TOny12@"
validate_certs: false
want_facts: true

# Group VMs by proxmox tags
keyed_groups:
  - key: proxmox_tags_parsed

groups:
  webservers: "'webserver' in (proxmox_tags_parsed | list)"
  ansible_vms: "'ansible' in (proxmox_tags_parsed | list)"

# Compose host variables for Ansible
compose:
  # ansible_user: "'ubuntu'"
  ansible_port: 22  
    #ansible_host: proxmox_agent_interfaces[1]["ip-addresses"][0].split('/')[0]
    #ansible_host: >-
    #"{{ proxmox_agent_interfaces
    #  | selectattr('name','equalto','eth0')   # pick eth0 only
    # | map(attribute='ip-addresses')         # get its IPs
    #  | sum(start=[])                          # flatten list
    # | map('regex_replace','/(.*)$','')       # remove subnet mask
    # | first 
    #  | default('192.168.88.147') }}"   
    #
    #
    #
    #
    #
    #

  ansible_host: proxmox_agent_interfaces
    | selectattr('name','equalto','eth0')
    | map(attribute='ip-addresses')
    | sum(start=[])
    | map('regex_replace','/(.*)$','')
    | first




# Don't override proxmox nodes IP (we want VMs)
want_proxmox_nodes_ansible_host: false

